## Файл конфігурації сервера


### Розділ `server`

```
server:
  host: "0.0.0.0"
  port: 8080
  include_ipv6: false
  url_format: "http://{IP}:{PORT}/"
```

- **host** — визначає, на яких мережевих інтерфейсах сервер приймає з'єднання.
  - `"127.0.0.1"` — сервер буде доступний лише з цього ж комп'ютера (локально).
  - `"0.0.0.0"` — сервер буде доступний усім пристроям у локальній мережі (через Wi-Fi або Ethernet).
  Використовуйте `"0.0.0.0"`, якщо до тестування підключаються інші пристрої у вашій локальній мережі.
- **port** — порт, на якому працює сервер.
  За замовчуванням використовується `8080`. Якщо цей порт зайнятий, можна змінити його, наприклад, на `8000`.
- **include_ipv6** — чи включати IPv6 адреси до списку мережевих інтерфейсів.
  За замовчуванням `false`. Якщо встановлено `true`, IPv6 адреси відображатимуться у списку URL-адрес для доступу з інших пристроїв.
- **url_format** — формат URL-адреси для відображення в адмін-панелі.
  За замовчуванням `"http://{IP}:{PORT}/"`. Використовуйте плейсхолдери `{IP}` та `{PORT}`.
  Приклад для зворотного проксі: `"http://{IP}/webquiz/"`

---

### Розділ `paths`

```
paths:
  quizzes_dir: "quizzes"
  logs_dir: "logs"
  csv_dir: "data"
  static_dir: "static"
```

Розділ `paths` задає розташування службових папок. Якщо зазначені каталоги відсутні, вони створюються автоматично при першому запуску.

- **quizzes_dir: "quizzes"**
  Папка для збереження тестів у форматі YAML.
  При першому запуску в ній створюється приклад тесту `default.yaml`.
  Усередині також може бути підпапка **`imgs`**, де зберігаються зображення, що використовуються у питаннях.

- **logs_dir: "logs"**
  Містить журнали роботи сервера.
  У цих файлах фіксуються повідомлення про запуск, помилки або інші події.
  Кожен новий запуск створює новий лог, наприклад `0001.log`, `0002.log`.

- **csv_dir: "data"**
  Каталог, де зберігаються результати тестів у форматі CSV.
  Для кожного тесту створюються два файли:
  - `default_0001.csv` — відповіді користувачів без персональних даних;
  - `default_0001.users.csv` — дані користувачів із реєстраційними полями, включаючи загальний час проходження тесту у форматі `MM:SS` (хвилини:секунди).
  Обидва файли можна відкрити у будь-якому табличному редакторі (Excel, Google Sheets).

- **static_dir: "static"**
  Папка зі статичними веб-файлами.
  Основний файл **index.html** є службовим і генерується або оновлюється автоматично.
  Редагувати його вручну не потрібно.

---

### Розділ `admin`

```
admin:
  master_key: a1
```

- **master_key** — ключ доступу до адміністративного інтерфейсу.
  Якщо ключ **вказано**, адміністратор може відкрити панель управління з будь-якого пристрою у мережі, ввівши цей ключ.
  Якщо ключ **не вказано**, адміністративна панель буде доступна **лише з локальних адрес** (наприклад, `127.0.0.1` або `localhost`), і у цьому випадку введення ключа **не потрібно**.

---

### Розділ `registration` (необов'язковий)

```
registration:
  approve: false
  username_label: "Ім'я користувача"
  fields:
    - Grade
    - School
```

Розділ визначає, як користувачі реєструються перед проходженням тестів.

- **approve**
  Якщо встановлено `true`, користувач після заповнення форми не зможе почати тест одразу — його заявка потрапить у список очікування, і адміністратор має схвалити її вручну.
  Якщо значення `false`, користувач може почати тестування одразу після реєстрації.

- **username_label**
  Налаштовує текст підпису для поля введення імені користувача у формі реєстрації.
  За замовчуванням: `"Ім'я користувача"` (український варіант).
  Приклади використання:
  ```
  username_label: "Прізвище та ім'я"
  username_label: "Логін учня"
  username_label: "Student Name"
  ```
  Цей підпис відображається як у формі реєстрації, так і у формі очікування схвалення.
  Підтримує спеціальні символи, емодзі та багатомовний текст.

- **fields**
  Додаткові поля реєстрації, які з'являються у формі перед початком тесту.
  Наприклад:
  ```
  fields:
    - Клас
    - Школа
    - Місто
  ```
  Усі зібрані дані автоматично потрапляють у CSV-файл результатів.

---

### Розділ `quizzes` (необов'язковий)

```
quizzes:
  - name: "Basic Math Quiz"
    download_path: "https://example.com/quizzes/math.zip"
    folder: "math_questions/"
```

Цей розділ дозволяє адміністратору завантажувати тести із зовнішніх джерел через адміністративний інтерфейс.

- **name** — назва тесту, яка відображається в адмін-панелі.
- **download_path** — посилання на архів із тестом (наприклад, `.zip`).
- **folder** — папка, у яку буде розпаковано вміст архіву після завантаження.

---

### Розділ `tunnel` (необов'язковий)

**Варіант 1: Отримання конфігурації з сервера**
```
tunnel:
  server: "tunnel.example.com"
  public_key: "keys/id_ed25519.pub"
  private_key: "keys/id_ed25519"
  socket_name: "my-quiz-socket"  # Необов'язково: фіксоване ім'я сокета (за замовчуванням: випадкові 6-8 символів)
  # Конфігурація буде завантажена з https://tunnel.example.com/tunnel_config.yaml
```

**Варіант 2: Локальна конфігурація (без завантаження з сервера)**
```
tunnel:
  server: "tunnel.example.com"
  public_key: "keys/id_ed25519.pub"
  private_key: "keys/id_ed25519"
  config:  # Необов'язково: вкажіть локально, щоб пропустити завантаження з сервера
    username: "tunneluser"
    socket_directory: "/var/run/tunnels"
    base_url: "https://tunnel.example.com/tests"
```

Розділ `tunnel` дозволяє налаштувати SSH-тунель для публічного доступу до локального сервера через зовнішній тунельний сервер. Це корисно для:
- Запуску тестів з локального комп'ютера без налаштування проброса портів
- Тимчасового публічного доступу без виділеного хостингу
- Класних кімнат, де учні підключаються поза локальною мережею

**Параметри:**

- **server** — доменне ім'я або IP-адреса тунельного сервера (наприклад, `"tunnel.example.com"`).
  Це сервер, який забезпечує публічний доступ до вашого локального WebQuiz.

- **public_key** — шлях до файлу публічного SSH-ключа.
  Якщо файл не існує, WebQuiz автоматично згенерує пару ключів ED25519.
  Приклад: `"keys/id_ed25519.pub"`

- **private_key** — шлях до файлу приватного SSH-ключа.
  Використовується для автентифікації на тунельному сервері.
  Приклад: `"keys/id_ed25519"`

- **socket_name** (необов'язково) — фіксоване ім'я сокета замість випадкової генерації.
  Дозволяє мати передбачувану URL-адресу для публічного доступу через тунель.
  Якщо не вказано, генерується випадковий ідентифікатор довжиною 6-8 символів.
  Приклад: `"my-quiz-socket"`

- **config** (необов'язковий підрозділ) — локальна конфігурація тунелю.
  Якщо вказано, WebQuiz використає цю конфігурацію замість завантаження з сервера.
  - **username** — SSH користувач для підключення до тунельного сервера
  - **socket_directory** — каталог на сервері для Unix domain sockets
  - **base_url** — базовий URL для доступу до тунелю (наприклад, `"https://tunnel.example.com/tests"`)

**Як це працює:**

1. **Автоматична генерація ключів**: Якщо ключі відсутні, WebQuiz автоматично створює пару ключів ED25519 без парольної фрази.

2. **Управління з адмін-панелі**: Відкрийте адміністративну панель, щоб переглянути статус тунелю.

3. **Копіювання публічного ключа**: Скопіюйте згенерований публічний ключ і додайте його до файлу `~/.ssh/authorized_keys` на тунельному сервері.

4. **Підключення**: Натисніть кнопку "Connect" в адмін-панелі для встановлення тунелю.

5. **Публічний URL**: Після підключення відобразиться публічний URL (наприклад, `https://tunnel.example.com/tests/a3f7b2/`).

6. **Автоматичне перепідключення**: Якщо з'єднання обривається, WebQuiz автоматично намагається відновити його.

**Вимоги до сервера:**
- Тунельний сервер повинен підтримувати переадресацію через Unix domain sockets
- Сервер має надавати endpoint `tunnel_config.yaml` за адресою `https://[server]/tunnel_config.yaml` з наступними параметрами:
  ```yaml
  username: tunneluser
  socket_directory: /var/run/tunnels
  base_url: https://tunnel.example.com/tests
  ```

**Примітки щодо безпеки:**
- SSH-ключі генеруються без парольної фрази для автоматичного підключення
- Приватний ключ зберігається з правами доступу 600 (тільки для власника)
- Підключення ініціює адміністратор (немає автоматичного підключення при запуску)
- Статус з'єднання відображається в реальному часі через WebSocket
